"use strict";(self["webpackChunkict_itmo"]=self["webpackChunkict_itmo"]||[]).push([[2121],{1163:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",[t.isPreview?i("div",[i("BaseNews",{attrs:{data:t.previewData}}),i("BaseButtonOutlined",{attrs:{text:"Назад","click-btn":!0},on:{clickBtnCallback:function(e){t.isPreview=!1}}})],1):i("div",[i("div",{staticClass:"d-flex pb-6"},[i("BaseButtonOutlined",{staticClass:"rounded-r-0",attrs:{text:"Анонсы",active:0===t.typeData,"click-btn":!0},on:{clickBtnCallback:function(e){return t.changeTypeData(0)}}}),i("BaseButtonOutlined",{staticClass:"rounded-l-0 ml-2",attrs:{text:"Новости",active:1===t.typeData,"click-btn":!0},on:{clickBtnCallback:function(e){return t.changeTypeData(1)}}})],1),i("div",{staticClass:"input-bordered mb-6"},[i("v-text-field",{staticClass:"input-border-0 text-h6 input-blue font-weight-bold",attrs:{placeholder:"Название "+(1===t.typeData?"новости":"анонса"),outlined:"",dense:"",dark:"dark"===t.theme,"hide-details":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),i("DraggableInputs",{attrs:{blocks:t.form.blocks},on:{changeDialogContent:t.changeDialogContent,changeDialog:t.changeDialog,beforeCropInsert:t.beforeCropInsert,deleteBlock:t.deleteBlock,updateBlock:t.updateBlock,beforeCropMultipleInsert:t.beforeCropMultipleInsert}}),1===t.typeData?i("div",{staticClass:"input-bordered mb-6 py-6"},[i("div",{staticClass:"input-bordered-label app-background"},[t._v(" Обложка новости"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("div",{staticClass:"input-file-container mx-auto",on:{dragover:function(t){t.preventDefault()},drop:function(t){t.preventDefault()}}},[i("input",{attrs:{id:"cover",type:"file",accept:"image/*"},on:{change:function(e){t.beforeCrop("cover",{w:480,h:300},"Обложка новости",e.target.files[0])}}}),i("label",{staticClass:"d-flex align-center py-6 px-12 text-center",attrs:{for:"cover"},on:{change:function(e){t.beforeCrop("cover",{w:480,h:300},"Обложка новости",e.dataTransfer.files[0])}}},[i("v-img",{staticStyle:{"z-index":"0"},attrs:{width:"80",height:"80",src:a(2012)}}),t._v(" Выберите изображение обложки или перетащите файл"),i("br"),t._v(" Размер 480*300 ")],1)]),t.form.cover?i("div",{staticClass:"text-center"},[t._v(" "+t._s(t.form.cover.name)+" ")]):t._e()]):t._e(),i("div",{staticClass:"input-bordered"},[i("v-checkbox",{staticClass:"input-blue pl-2",attrs:{dark:"dark"===t.theme,dense:"",label:"Добавить в слайдер"},model:{value:t.form.isSlider,callback:function(e){t.$set(t.form,"isSlider",e)},expression:"form.isSlider"}}),t.form.isSlider?i("div",{staticClass:"py-6"},[i("div",{staticClass:"input-file-container mx-auto",on:{dragover:function(t){t.preventDefault()},drop:function(t){t.preventDefault()}}},[i("input",{attrs:{id:"sliderImg",type:"file",accept:"image/*"},on:{change:function(e){t.beforeCrop("sliderImg",{w:912,h:400},"Слайдер",e.target.files[0])}}}),i("label",{staticClass:"d-flex align-center py-6 px-12 text-center",attrs:{for:"sliderImg"},on:{change:function(e){t.beforeCrop("sliderImg",{w:912,h:400},"Слайдер",e.dataTransfer.files[0])}}},[i("v-img",{staticStyle:{"z-index":"0"},attrs:{width:"80",height:"80",src:a(2012)}}),t._v(" Выберите изображение обложки или перетащите файл"),i("br"),t._v(" Размер 1140*500 ")],1)]),t.form.sliderImg?i("div",{staticClass:"text-center"},[t._v(" "+t._s(t.form.sliderImg.name)+" ")]):t._e()]):t._e()],1),i("div",{staticClass:"px-0 mt-4 subtitle-color",staticStyle:{cursor:"pointer",width:"fit-content"},on:{click:t.addBlock}},[i("v-icon",{attrs:{color:"#0071B2"}},[t._v(" mdi-plus-circle-outline ")]),t._v(" Добавить поле ")],1),i("v-row",{staticClass:"pt-4"},[i("v-col",{attrs:{cols:"12",md:"3"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Дата начала мероприятия"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.dateStart,callback:function(e){t.$set(t.form,"dateStart",e)},expression:"form.dateStart"}})],1),0===t.typeData?i("v-col",{attrs:{cols:"12",md:"3"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Дата конца мероприятия ")]),i("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.dateEnd,callback:function(e){t.$set(t.form,"dateEnd",e)},expression:"form.dateEnd"}})],1):t._e(),i("v-col",{attrs:{cols:"12",md:"2"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Время начала ")]),i("v-text-field",{staticClass:"search-input",attrs:{type:"time",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.timeStart,callback:function(e){t.$set(t.form,"timeStart",e)},expression:"form.timeStart"}})],1)],1),i("v-row",[i("v-col",{attrs:{cols:"12",md:"3"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Дата выхода поста"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.datePublish,callback:function(e){t.$set(t.form,"datePublish",e)},expression:"form.datePublish"}})],1),i("v-col",{attrs:{cols:"12",md:"2"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Время выхода"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("v-text-field",{staticClass:"search-input",attrs:{type:"time",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.timePublish,callback:function(e){t.$set(t.form,"timePublish",e)},expression:"form.timePublish"}})],1)],1),0===t.typeData?i("v-col",{staticClass:"px-0",attrs:{cols:"12",md:"4"}},[i("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Место проведения"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("v-text-field",{staticClass:"search-input",attrs:{placeholder:"Введите место мероприятия",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:t.form.place,callback:function(e){t.$set(t.form,"place",e)},expression:"form.place"}})],1):t._e(),i("v-col",{staticClass:"px-0",attrs:{cols:"12",md:"4"}},[i("div",{staticClass:"pl-4 subtitle-color  text-body-2",staticStyle:{opacity:"0.7"}},[t._v(" Теги"),i("span",{staticClass:"error--text"},[t._v("*")])]),i("v-autocomplete",{staticClass:"search-input",attrs:{items:t.tags,"item-value":"id","item-text":"name",multiple:"",outlined:"",dense:"",dark:"dark"===t.theme,color:"dark"===t.theme?"#00A1FF":"#005A8E","hide-details":"",chips:"","append-icon":"mdi-chevron-down"},scopedSlots:t._u([{key:"selection",fn:function(e){var a=e.item;return[i("BaseChip",{staticClass:"mr-3",attrs:{item:a},scopedSlots:t._u([{key:"chip-btns",fn:function(){return[i("v-btn",{attrs:{icon:"",dark:"","x-small":""},on:{click:function(e){return t.removeTag(a)}}},[i("v-icon",{attrs:{small:""}},[t._v(" mdi-close-circle-outline ")])],1)]},proxy:!0}],null,!0)})]}}],null,!1,7897401),model:{value:t.form.tagsIds,callback:function(e){t.$set(t.form,"tagsIds",e)},expression:"form.tagsIds"}})],1),i("div",{staticClass:"d-flex pt-6"},[i("BaseButton",{attrs:{text:"Опубликовать","click-btn":!0,"disabled-btn":t.canBePublished()},on:{clickBtnCallback:t.publish}}),i("BaseButtonOutlined",{staticClass:"ml-4",attrs:{text:"Предпросмотр","click-btn":!0},on:{clickBtnCallback:t.preview}})],1)],1),i("DialogPreviewComponent",{attrs:{dialog:t.dialog,"dialog-content":t.dialogContent},on:{changeDialog:t.changeDialog,beforeCropInsert:t.beforeCropInsert,beforeCropMultipleInsertOne:t.beforeCropMultipleInsertOne}}),i("DialogCroppieComponent",{attrs:{dialog:t.dialogCroppie,title:t.dialogCroppieOptions.title,size:t.dialogCroppieOptions.size,"data-img":t.dialogCroppieDataImg,"enable-resize":t.dialogCroppieOptions.enableResize},on:{changeDialog:t.changeDialogCroppie,changeCroppie:t.changeCroppie}}),i("DialogCroppieMultipleComponent",{attrs:{dialog:t.dialogCroppieMultiple,"data-img":t.dialogCroppieMultipleDataImg,edit:t.dialogCroppieMultipleEdit},on:{changeDialog:t.changeDialogCroppieMultiple,changeCroppie:t.changeCroppieMultiple}})],1)},l=[],s=a(629),o=a(2100),n=a(7566),r=a(9522),c={name:"AdminCreateEntryView",components:{DialogCroppieMultipleComponent:()=>Promise.all([a.e(9383),a.e(1182)]).then(a.bind(a,9383)),DialogCroppieComponent:()=>Promise.all([a.e(8493),a.e(522)]).then(a.bind(a,8493)),DialogPreviewComponent:()=>Promise.all([a.e(4202),a.e(4117)]).then(a.bind(a,4202)),BaseNews:()=>a.e(5356).then(a.bind(a,9541)),DraggableInputs:()=>Promise.all([a.e(2739),a.e(9980),a.e(1247),a.e(3307)]).then(a.bind(a,1247)),BaseChip:()=>a.e(4494).then(a.bind(a,4494)),BaseButtonOutlined:()=>a.e(2149).then(a.bind(a,2149)),BaseButton:()=>a.e(1992).then(a.bind(a,1992))},mixins:[o.Z,n.Z,r.Z],data:()=>({dialog:!1,dialogContent:{},typeData:0,isPreview:!1,previewData:{},form:{title:"",dateStart:null,dateEnd:null,timeStart:null,datePublish:null,timePublish:null,place:"",tagsIds:[],isSlider:!1,sliderImg:null,sliderImgCroppie:null,sliderImgBlob:null,cover:null,coverCroppie:null,coverBlob:null,blocks:[{id:0,type:-1,content:null}],attachmentsIds:[]}}),computed:{...(0,s.rn)("app",["theme"]),...(0,s.rn)("news",["tagsCategories","tags"])},async mounted(){await this.getTags()},methods:{...(0,s.nv)("news",["getTags"]),...(0,s.nv)("admin",["addAttachment","addNews","addAnnouncement"]),canBePublished(){let t=!0;1!==this.typeData||this.form.cover||(t=!1),0!==this.typeData||this.form.place||(t=!1);for(const e of this.form.blocks)if(-1===e.type){t=!1;break}return!(this.form.title&&this.form.dateStart&&this.form.tagsIds.length&&this.form.blocks.length&&t)},changeTypeData(t){this.typeData=t},removeTag(t){const e=this.form.tagsIds.indexOf(t.id);e>=0&&this.form.tagsIds.splice(e,1)},async publish(){let t=Object.assign({},this.form);if(t.timeStart){let e=t.timeStart.split(":");t.dateStart=new Date(t.dateStart),t.dateStart.setHours(parseInt(e[0]),parseInt(e[1]))}t.dateStart=this.$moment(t.dateStart).format(),0===this.typeData&&t.dateEnd&&(t.dateEnd=this.$moment(t.dateEnd).format()),1===this.typeData&&(t.date=t.dateStart),1===this.typeData&&await this.addAttachment(t.coverBlob).then((e=>{t.imageId=e.data.id})).catch((()=>({})));for(let e of t.blocks){if(1===e.type)for(const t of e.content.blocks){if(2===t.type&&t.content.imgName.blob&&await this.addAttachment(t.content.imgName.blob).then((e=>{t.content.imgName.croppie=e.data.url})).catch((()=>({}))),3===t.type){for(let e of t.content.imagesName)e["blob"]&&await this.addAttachment(e["blob"]).then((t=>{e.croppie=t.data.url})).catch((()=>({}))),delete e.original,delete e["blob"];delete t.content.images}delete t.id,2===t.type&&(delete t.content.img,delete t.content.imgName.original,delete t.content.imgName.blob)}if(2===e.type&&e.content.imgName.blob&&await this.addAttachment(e.content.imgName.blob).then((t=>{e.content.imgName.croppie=t.data.url})).catch((()=>({}))),3===e.type){for(let t of e.content.imagesName)t["blob"]&&await this.addAttachment(t["blob"]).then((e=>{t.croppie=e.data.url})).catch((()=>({}))),delete t.original,delete t["blob"];delete e.content.images}delete e.id,2===e.type&&(delete e.content.img,delete e.content.imgName.original,delete e.content.imgName.blob)}1===this.typeData&&await this.addNews(t),0===this.typeData&&await this.addAnnouncement(t),this.$router.push("/published").then()},preview(){this.previewData=Object.assign({},this.form),this.previewData.tags=[],this.previewData.tagsIds.forEach(((t,e)=>{this.previewData.tags[e]=this.tags.find((e=>e.id===t))})),this.isPreview=!0}}},d=c,p=a(1001),m=a(3453),u=a.n(m),h=a(1835),f=a(3150),b=a(3702),g=a(2102),v=a(9846),C=a(6428),k=a(7047),y=a(2877),x=a(314),D=(0,p.Z)(d,i,l,!1,null,null,null),w=D.exports;u()(D,{VAutocomplete:h.Z,VBtn:f.Z,VCheckbox:b.Z,VCol:g.Z,VContainer:v.Z,VIcon:C.Z,VImg:k.Z,VRow:y.Z,VTextField:x.Z})}}]);
//# sourceMappingURL=2121.426c7da8.js.map