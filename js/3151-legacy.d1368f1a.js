"use strict";(self["webpackChunkict_itmo"]=self["webpackChunkict_itmo"]||[]).push([[3151],{88258:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.loading&&Object.keys(e.announcement).length?a("v-container",[e.isPreview?a("div",[a("BaseNews",{attrs:{data:e.previewData}}),a("BaseButtonOutlined",{attrs:{text:"Назад","click-btn":!0},on:{clickBtnCallback:function(t){e.isPreview=!1}}})],1):a("div",[a("div",{staticClass:"input-bordered mb-6"},[a("v-text-field",{staticClass:"input-border-0 text-h6 input-blue font-weight-bold",attrs:{placeholder:"Название анонса",outlined:"",dense:"",dark:"dark"===e.theme,"hide-details":""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),a("DraggableInputs",{attrs:{blocks:e.form.blocks},on:{changeDialogContent:e.changeDialogContent,changeDialog:e.changeDialog,beforeCropInsert:e.beforeCropInsert,deleteBlock:e.deleteBlock,updateBlock:e.updateBlock,beforeCropMultipleInsert:e.beforeCropMultipleInsert}}),a("div",{staticClass:"input-bordered"},[a("v-checkbox",{staticClass:"input-blue pl-2",attrs:{dark:"dark"===e.theme,dense:"",label:"Добавить в слайдер"},model:{value:e.form.isSlider,callback:function(t){e.$set(e.form,"isSlider",t)},expression:"form.isSlider"}}),e.form.isSlider?a("div",{staticClass:"py-6"},[a("div",{staticClass:"input-file-container mx-auto",on:{dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault()}}},[a("input",{attrs:{id:"sliderImg",type:"file",accept:"image/*"},on:{change:function(t){e.beforeCrop("sliderImg",{w:912,h:400},"Слайдер",t.target.files[0])}}}),a("label",{staticClass:"d-flex align-center py-6 px-12 text-center",attrs:{for:"sliderImg"},on:{change:function(t){e.beforeCrop("sliderImg",{w:912,h:400},"Слайдер",t.dataTransfer.files[0])}}},[a("v-img",{staticStyle:{"z-index":"0"},attrs:{width:"80",height:"80",src:n(42012)}}),e._v(" Выберите изображение обложки или перетащите файл"),a("br"),e._v(" Размер 1140*500 ")],1)]),e.form.sliderImg?a("div",{staticClass:"text-center"},[e._v(" "+e._s(e.form.sliderImg.name)+" ")]):e._e()]):e._e()],1),a("div",{staticClass:"px-0 mt-4 subtitle-color",staticStyle:{cursor:"pointer",width:"fit-content"},on:{click:e.addBlock}},[a("v-icon",{attrs:{color:"#0071B2"}},[e._v(" mdi-plus-circle-outline ")]),e._v(" Добавить поле ")],1),a("v-row",{staticClass:"pt-4"},[a("v-col",{attrs:{cols:"12",md:"3"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Дата начала мероприятия"),a("span",{staticClass:"error--text"},[e._v("*")])]),a("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.dateStart,callback:function(t){e.$set(e.form,"dateStart",t)},expression:"form.dateStart"}})],1),a("v-col",{attrs:{cols:"12",md:"3"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Дата конца мероприятия ")]),a("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.dateEnd,callback:function(t){e.$set(e.form,"dateEnd",t)},expression:"form.dateEnd"}})],1),a("v-col",{attrs:{cols:"12",md:"2"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Время начала ")]),a("v-text-field",{staticClass:"search-input",attrs:{type:"time",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.timeStart,callback:function(t){e.$set(e.form,"timeStart",t)},expression:"form.timeStart"}})],1)],1),a("v-row",[a("v-col",{attrs:{cols:"12",md:"3"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Дата выхода поста"),a("span",{staticClass:"error--text"},[e._v("*")])]),a("v-text-field",{staticClass:"search-input",attrs:{type:"date",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.datePublish,callback:function(t){e.$set(e.form,"datePublish",t)},expression:"form.datePublish"}})],1),a("v-col",{attrs:{cols:"12",md:"2"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Время выхода"),a("span",{staticClass:"error--text"},[e._v("*")])]),a("v-text-field",{staticClass:"search-input",attrs:{type:"time",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.timePublish,callback:function(t){e.$set(e.form,"timePublish",t)},expression:"form.timePublish"}})],1)],1),a("v-col",{staticClass:"px-0",attrs:{cols:"12",md:"4"}},[a("div",{staticClass:"pl-4 subtitle-color text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Место проведения"),a("span",{staticClass:"error--text"},[e._v("*")])]),a("v-text-field",{staticClass:"search-input",attrs:{placeholder:"Введите место мероприятия",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":""},model:{value:e.form.place,callback:function(t){e.$set(e.form,"place",t)},expression:"form.place"}})],1),a("v-col",{staticClass:"px-0",attrs:{cols:"12",md:"4"}},[a("div",{staticClass:"pl-4 subtitle-color  text-body-2",staticStyle:{opacity:"0.7"}},[e._v(" Теги"),a("span",{staticClass:"error--text"},[e._v("*")])]),a("v-autocomplete",{staticClass:"search-input",attrs:{items:e.tags,"item-value":"id","item-text":"name",multiple:"",outlined:"",dense:"",dark:"dark"===e.theme,color:"dark"===e.theme?"#00A1FF":"#005A8E","hide-details":"",chips:"","append-icon":"mdi-chevron-down"},scopedSlots:e._u([{key:"selection",fn:function(t){var n=t.item;return[a("BaseChip",{staticClass:"mr-3",attrs:{item:n},scopedSlots:e._u([{key:"chip-btns",fn:function(){return[a("v-btn",{attrs:{icon:"",dark:"","x-small":""},on:{click:function(t){return e.removeTag(n)}}},[a("v-icon",{attrs:{small:""}},[e._v(" mdi-close-circle-outline ")])],1)]},proxy:!0}],null,!0)})]}}],null,!1,7897401),model:{value:e.form.tagsIds,callback:function(t){e.$set(e.form,"tagsIds",t)},expression:"form.tagsIds"}})],1),a("div",{staticClass:"d-flex pt-6"},[a("BaseButton",{attrs:{text:"Опубликовать","click-btn":!0,"disabled-btn":e.canBePublished()},on:{clickBtnCallback:e.publish}}),a("BaseButtonOutlined",{staticClass:"ml-4",attrs:{text:"Предпросмотр","click-btn":!0},on:{clickBtnCallback:e.preview}})],1)],1),a("DialogPreviewComponent",{attrs:{dialog:e.dialog,"dialog-content":e.dialogContent},on:{changeDialog:e.changeDialog,beforeCropInsert:e.beforeCropInsert,beforeCropMultipleInsertOne:e.beforeCropMultipleInsertOne}}),a("DialogCroppieComponent",{attrs:{dialog:e.dialogCroppie,title:e.dialogCroppieOptions.title,size:e.dialogCroppieOptions.size,"data-img":e.dialogCroppieDataImg,"enable-resize":e.dialogCroppieOptions.enableResize},on:{changeDialog:e.changeDialogCroppie,changeCroppie:e.changeCroppie}}),a("DialogCroppieMultipleComponent",{attrs:{dialog:e.dialogCroppieMultiple,"data-img":e.dialogCroppieMultipleDataImg,edit:e.dialogCroppieMultipleEdit},on:{changeDialog:e.changeDialogCroppieMultiple,changeCroppie:e.changeCroppieMultiple}})],1):e.loading?a("BaseNotFound"):a("div",{staticClass:"d-flex justify-center fill-height align-center"},[a("v-progress-circular",{attrs:{indeterminate:""}})],1)},i=[],r=n(62032),o=n(16198),s=n(4367),l=(n(35666),n(41539),n(78783),n(33948),n(47941),n(21249),n(74916),n(15306),n(40561),n(23123),n(54747),n(69826),n(20629)),c=n(22100),d=n(47566),m=n(19522),u={name:"AdminUpdateAnnouncementView",components:{BaseNotFound:function(){return n.e(6643).then(n.bind(n,6643))},DialogCroppieMultipleComponent:function(){return Promise.all([n.e(3548),n.e(1152)]).then(n.bind(n,39383))},DialogCroppieComponent:function(){return Promise.all([n.e(3548),n.e(1133)]).then(n.bind(n,28493))},DialogPreviewComponent:function(){return Promise.all([n.e(3548),n.e(2020)]).then(n.bind(n,74202))},BaseNews:function(){return n.e(5356).then(n.bind(n,99541))},DraggableInputs:function(){return Promise.all([n.e(2739),n.e(9980),n.e(1247),n.e(3307)]).then(n.bind(n,91247))},BaseChip:function(){return n.e(4494).then(n.bind(n,44494))},BaseButtonOutlined:function(){return n.e(2149).then(n.bind(n,2149))},BaseButton:function(){return n.e(1992).then(n.bind(n,1992))}},mixins:[c.Z,d.Z,m.Z],data:function(){return{loading:!1,dialog:!1,dialogContent:{},isPreview:!1,previewData:{},form:{title:"",dateStart:null,dateEnd:null,timeStart:null,datePublish:null,timePublish:null,place:"",tagsIds:[],isSlider:!1,sliderImg:null,sliderImgCroppie:null,sliderImgBlob:null,blocks:[{id:0,type:-1,content:null}],attachmentsIds:[]}}},computed:(0,s.Z)((0,s.Z)({},(0,l.rn)("app",["theme"])),(0,l.rn)("news",["tagsCategories","tags","announcement"])),mounted:function(){var e=this;return(0,o.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getTags();case 2:return t.next=4,e.getAnnouncement(e.$route.params.id);case 4:Object.keys(e.announcement).length&&e.dataToForm(),e.loading=!0;case 6:case"end":return t.stop()}}),t)})))()},methods:(0,s.Z)((0,s.Z)((0,s.Z)({},(0,l.nv)("news",["getTags","getAnnouncement"])),(0,l.nv)("admin",["addAttachment","updateAnnouncement"])),{},{dataToForm:function(){this.form.id=this.announcement.id,this.form.title=this.announcement.title,this.form.place=this.announcement.place,this.form.dateStart=this.$moment(this.announcement.dateStart).format("YYYY-MM-DD"),this.form.dateEnd=this.announcement.dateEnd?this.$moment(this.announcement.dateEnd).format("YYYY-MM-DD"):"",this.form.timeStart=this.$moment(this.announcement.dateStart).format("HH:mm"),this.form.tagsIds=this.announcement.tags.map((function(e){return e.id})),this.form.blocks=this.announcement.blocks;for(var e=0;e<this.form.blocks.length;e++){if(this.form.blocks[e].id=e,0===this.form.blocks[e].type){this.form.blocks[e].content.text=this.form.blocks[e].content.text.replace("<div>","").replace("</div>","");var t=new DOMParser;this.form.blocks[e].content.text=t.parseFromString(this.form.blocks[e].content.text,"text/html").body.innerHTML,this.form.blocks[e].content.text=this.form.blocks[e].content.text.replace(/\r/g,"").replace(/\n/g,"")}if(1===this.form.blocks[e].type){this.form.blocks[e].content.blocks[0].id=1e3*(e+1)+1,this.form.blocks[e].content.blocks[1].id=1e3*(e+1)+2;var n,a=(0,r.Z)(this.form.blocks[e].content.blocks);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(2===i.type&&(i.content.img=null,i.content.imgName.blob=null,i.content.imgName.original=i.content.imgName.croppie),3===i.type){i.content.images=[];var o,s=1,l=(0,r.Z)(i.content.imagesName);try{for(l.s();!(o=l.n()).done;){var c=o.value;i.content.images.push({name:s+" img"}),s+=1,c.original=c.croppie,c.blob=null}}catch(f){l.e(f)}finally{l.f()}}}}catch(f){a.e(f)}finally{a.f()}}if(2===this.form.blocks[e].type&&(this.form.blocks[e].content.img=null,this.form.blocks[e].content.imgName.blob=null,this.form.blocks[e].content.imgName.original=this.form.blocks[e].content.imgName.croppie),3===this.form.blocks[e].type){this.form.blocks[e].content.images=[];var d,m=1,u=(0,r.Z)(this.form.blocks[e].content.imagesName);try{for(u.s();!(d=u.n()).done;){var p=d.value;this.form.blocks[e].content.images.push({name:m+" img",id:m}),m+=1,p.original=p.croppie,p.blob=null}}catch(f){u.e(f)}finally{u.f()}}}this.count=this.form.blocks.length+1},canBePublished:function(){var e,t=!0,n=(0,r.Z)(this.form.blocks);try{for(n.s();!(e=n.n()).done;){var a=e.value;if(-1===a.type){t=!1;break}}}catch(i){n.e(i)}finally{n.f()}return!(this.form.place&&this.form.title&&this.form.dateStart&&this.form.tagsIds.length&&this.form.blocks.length&&t)},removeTag:function(e){var t=this.form.tagsIds.indexOf(e.id);t>=0&&this.form.tagsIds.splice(t,1)},publish:function(){var e=this;return(0,o.Z)(regeneratorRuntime.mark((function t(){var n,a,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=Object.assign({},e.form),n.timeStart&&(a=n.timeStart.split(":"),n.dateStart=new Date(n.dateStart),n.dateStart.setHours(parseInt(a[0]),parseInt(a[1]))),n.dateStart=e.$moment(n.dateStart).format(),n.dateEnd?n.dateEnd=e.$moment(n.dateEnd).format():n.dateEnd=null,i=(0,r.Z)(n.blocks),t.prev=5,s=regeneratorRuntime.mark((function t(){var n,a,i,s,l,c,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=o.value,1!==n.type){t.next=18;break}a=(0,r.Z)(n.content.blocks),t.prev=3,s=regeneratorRuntime.mark((function t(){var n,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=i.value,2!==n.type||!n.content.imgName.blob){t.next=4;break}return t.next=4,e.addAttachment(n.content.imgName.blob).then((function(e){n.content.imgName.croppie=e.data.url})).catch((function(){return{}}));case 4:if(3!==n.type){t.next=22;break}a=(0,r.Z)(n.content.imagesName),t.prev=6,s=regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=o.value,!n["blob"]){t.next=4;break}return t.next=4,e.addAttachment(n["blob"]).then((function(e){n.croppie=e.data.url})).catch((function(){return{}}));case 4:delete n.original,delete n["blob"];case 6:case"end":return t.stop()}}),t)})),a.s();case 9:if((o=a.n()).done){t.next=13;break}return t.delegateYield(s(),"t0",11);case 11:t.next=9;break;case 13:t.next=18;break;case 15:t.prev=15,t.t1=t["catch"](6),a.e(t.t1);case 18:return t.prev=18,a.f(),t.finish(18);case 21:delete n.content.images;case 22:delete n.id,2===n.type&&(delete n.content.img,delete n.content.imgName.original,delete n.content.imgName.blob);case 24:case"end":return t.stop()}}),t,null,[[6,15,18,21]])})),a.s();case 6:if((i=a.n()).done){t.next=10;break}return t.delegateYield(s(),"t0",8);case 8:t.next=6;break;case 10:t.next=15;break;case 12:t.prev=12,t.t1=t["catch"](3),a.e(t.t1);case 15:return t.prev=15,a.f(),t.finish(15);case 18:if(2!==n.type||!n.content.imgName.blob){t.next=21;break}return t.next=21,e.addAttachment(n.content.imgName.blob).then((function(e){n.content.imgName.croppie=e.data.url})).catch((function(){return{}}));case 21:if(3!==n.type){t.next=39;break}l=(0,r.Z)(n.content.imagesName),t.prev=23,d=regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=c.value,!n["blob"]){t.next=4;break}return t.next=4,e.addAttachment(n["blob"]).then((function(e){n.croppie=e.data.url})).catch((function(){return{}}));case 4:delete n.original,delete n["blob"];case 6:case"end":return t.stop()}}),t)})),l.s();case 26:if((c=l.n()).done){t.next=30;break}return t.delegateYield(d(),"t2",28);case 28:t.next=26;break;case 30:t.next=35;break;case 32:t.prev=32,t.t3=t["catch"](23),l.e(t.t3);case 35:return t.prev=35,l.f(),t.finish(35);case 38:delete n.content.images;case 39:delete n.id,2===n.type&&(delete n.content.img,delete n.content.imgName.original,delete n.content.imgName.blob);case 41:case"end":return t.stop()}}),t,null,[[3,12,15,18],[23,32,35,38]])})),i.s();case 8:if((o=i.n()).done){t.next=12;break}return t.delegateYield(s(),"t0",10);case 10:t.next=8;break;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t["catch"](5),i.e(t.t1);case 17:return t.prev=17,i.f(),t.finish(17);case 20:return t.next=22,e.updateAnnouncement(n);case 22:e.$router.push("/published").then();case 23:case"end":return t.stop()}}),t,null,[[5,14,17,20]])})))()},preview:function(){var e=this;this.previewData=Object.assign({},this.form),this.previewData.tags=[],this.previewData.tagsIds.forEach((function(t,n){e.previewData.tags[n]=e.tags.find((function(e){return e.id===t}))})),this.isPreview=!0}})},p=u,f=n(1001),h=n(43453),b=n.n(h),g=n(71835),v=n(63150),k=n(83702),x=n(82102),C=n(99846),y=n(96428),w=n(97047),S=n(90624),I=n(62877),D=n(40314),B=(0,f.Z)(p,a,i,!1,null,null,null),Z=B.exports;b()(B,{VAutocomplete:g.Z,VBtn:v.Z,VCheckbox:k.Z,VCol:x.Z,VContainer:C.Z,VIcon:y.Z,VImg:w.Z,VProgressCircular:S.Z,VRow:I.Z,VTextField:D.Z})}}]);
//# sourceMappingURL=3151-legacy.d1368f1a.js.map